<!DOCTYPE html>

<html
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{/member/layout/memberLayout.html}">

<div class="login" layout:fragment="content">

    <script>
        // 클릭 이벤트 처리 함수
        function preventClick(event, element) {
            event.preventDefault(); // 기본 동작 중지
            console.log(event);
            console.log(element.getAttribute('data-bannerNo'));//이렇게 함수에 bannerNo를 담아서 옴
            console.log(element.getAttribute('data-link'));//link주소도 받아와짐

            const bannerNo = element.getAttribute('data-bannerNo');
            const link = element.getAttribute('data-link');


            const jsonData = {
                "bannerNo": bannerNo,
                "link": link
            }

            fetch("/lotteshop/main/index", {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(jsonData)
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('데이터 전송에 실패!');
                    } else {
                        window.location.href = link;
                    }
                    return response.json();
                })
                .then(data => {
                    console.log(data);
                })
                .catch(err => console.log(err))
        }

    </script>


    <nav>
        <h1>로그인</h1>
    </nav>

    <form th:action method="post">

        <table border="0">
            <tr>
                <td>아이디</td>
                <td><input type="text" name="uid" placeholder="아이디 입력"></td>
            </tr>
            <tr>
                <td>비밀번호</td>
                <td><input type="password" name="pass" placeholder="비밀번호 입력"></td>
            </tr>
        </table>
        <input type="submit" value="로그인"/>
        <span>
            <label><input type="checkbox" name="auto"/>자동 로그인</label>
            <a href="#">아이디찾기</a>
            <a href="#">비밀번호찾기</a>
            <a th:href="@{/member/join}">회원가입</a>
        </span>

        <div class="social">
            <a th:href="@{/oauth2/authorization/google}">
                <img class="google_img" th:src="@{/member/images/google.png}" alt="로그인">
            </a>

            <a th:href="@{/oauth2/authorization/kakao}">
                <img class="kakao_img" th:src="@{/member/images/kakao.png}" alt="로그인">
            </a>
            <a th:href="@{/oauth2/authorization/naver}">
                <img class="naver_img" th:src="@{/member/images/naver.png}" alt="로그인">
            </a>
        </div>
        <th:block th:each="banner : ${banner4}">
            <a th:if="${banner.status} == 1" th:data-bannerNo="${banner.bannerNo}" th:data-link="${banner.link}"
               th:onclick="'preventClick(event ,this)'" th:href="@{${banner.link}}">
                <img th:src="@{/uploads/__${banner.img_425}__}" alt="1만원 할인 쿠폰 받기">
            </a>
        </th:block>
    </form>
    <img th:src="@{/member/images/member_certifi_logo.gif}" alt="banner">
</div>

</html>