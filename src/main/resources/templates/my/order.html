<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/my/layout/myLayout.html}">


            <div class="ordered" layout:fragment="content">
                <ul>
                    <span class="menu_else"></span>
                    <li class="on"><a th:href="@{/my/order}">전체주문내역</a></li>
                    <!--<li><a href="./favorite.html">관심상품</a></li>-->
                    <li><a th:href="@{/my/order}">포인트내역</a></li>
                    <li><a th:href="@{/my/coupon}">쿠폰</a></li>
                    <li><a th:href="@{/my/review}">나의리뷰</a></li>
                    <li><a th:href="@{/my/qna}">문의하기</a></li>
                    <li><a th:href="@{/my/info}">나의설정</a></li>
                </ul>

                <section>
                    <a th:href="@{#}"><img th:src="@{/my/images/my_banner1.jpg}" alt="패션, 타운 하나로 끝" class="banner"></a>
                    <article>
                        <h3>전체주문내역</h3>

                        <div class="byDate">
                            <span class="tit">기간별조회</span>
                            <ul class="date_3ea">
                                <th:block th:if="${pageResponseDTO.oneWeek =='yes'}">
                                    <li ><a  class="on" th:href="@{/my/order(oneWeek = 'yes')}"><em>1</em>주일</a></li>
                                    <li><a th:href="@{/my/order(fifteen = 'yes')}"><em>15</em>일</a></li>
                                    <th:block th:with="currentMonth=${T(java.time.LocalDate).now().getMonthValue()}">
                                        <li><a th:href="@{/my/order(currentMonth = ${currentMonth})}" ><em>1</em>개월</a></li>
                                    </th:block>
                                </th:block>

                                <th:block th:if="${pageResponseDTO.fifteen =='yes'}">
                                    <li ><a th:href="@{/my/order(oneWeek = 'yes')}"><em>1</em>주일</a></li>
                                    <li ><a  class="on" th:href="@{/my/order(fifteen = 'yes')}"><em>15</em>일</a></li>
                                    <th:block th:with="currentMonth=${T(java.time.LocalDate).now().getMonthValue()}">
                                        <li><a th:href="@{/my/order(currentMonth = ${currentMonth})}" ><em>1</em>개월</a></li>
                                    </th:block>
                                </th:block>

                                <th:block th:if="${pageResponseDTO.fifteen !='yes' && pageResponseDTO.oneWeek != 'yes'}">
                                    <li ><a th:href="@{/my/order(oneWeek = 'yes')}"><em>1</em>주일</a></li>
                                    <li ><a th:href="@{/my/order(fifteen = 'yes')}"><em>15</em>일</a></li>
                                    <th:block th:with="currentMonth=${T(java.time.LocalDate).now().getMonthValue()}">
                                        <li ><a  class="on" th:href="@{/my/order(currentMonth = ${currentMonth})}" ><em>1</em>개월</a></li>
                                    </th:block>
                                </th:block>
                            </ul>
                            <ul class="date_5ea">
                                <th:block th:with="currentMonth=${T(java.time.LocalDate).now().getMonthValue()}">
                                    <li th:each="i : ${#numbers.sequence(0, 4)}">
                                        <a  th:href="@{/my/order(currentMonth = ${currentMonth - i})}">
                                            <em th:if="${currentMonth - i > 0}" th:text="${(currentMonth - i)}"></em>
                                            <em th:if="${currentMonth - i <= 0}" th:text="${(currentMonth - i) + 12}"></em>월
                                            <span th:if="${currentMonth - i <= 0}"></span>
                                        </a>

                                    </li>
                                </th:block>
                            </ul>
                            <form th:action="@{/my/order}">
                                <input type="date" name="dateBegin" min="[LAST_DATE]" max="[CURRENT_DATE]" required>
                                <span>~</span>
                                <input type="date" name="dateEnd" max="[CURRENT_DATE]" required>
                                <button class="btnConfirm" type="submit">조회하기</button>
                            </form>
                        </div>
                        <script>
                            window.onload=function (){
                                // 현재 날짜 가져오기
                                var currentDate = new Date().toISOString().split('T')[0];

                                // 현재 날짜의 1년 전 날짜 계산
                                var oneYearAgo = new Date();
                                oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);
                                var oneYearAgoDate = oneYearAgo.toISOString().split('T')[0];

                                // 최대 날짜 설정
                                document.getElementsByName("dateBegin")[0].setAttribute('max', currentDate);
                                document.getElementsByName("dateBegin")[0].setAttribute('min', oneYearAgoDate);
                                document.getElementsByName("dateEnd")[0].setAttribute('max', currentDate);


                                // 입력 필드의 날짜 변경 이벤트 리스너 등록
                                document.getElementsByName("dateBegin")[0].addEventListener('change', function() {
                                    var startDate = new Date(this.value);
                                    var endDate = new Date(document.getElementsByName("dateEnd")[0].value);

                                    // 시작일과 종료일을 비교하여 종료일이 시작일보다 이전이면 종료일을 시작일과 동일하게 설정
                                    if (startDate > endDate) {
                                        document.getElementsByName("dateEnd")[0].value = this.value;
                                    }
                                });

                                document.getElementsByName("dateEnd")[0].addEventListener('change', function() {
                                    var startDate = new Date(document.getElementsByName("dateBegin")[0].value);
                                    var endDate = new Date(this.value);

                                    // 종료일과 시작일을 비교하여 시작일이 종료일보다 이후면 시작일을 종료일과 동일하게 설정
                                    if (endDate < startDate) {
                                        document.getElementsByName("dateBegin")[0].value = this.value;
                                    }
                                });

                            }
                        </script>
                        <table border="0">
                            <tr>
                                <th>날짜</th>
                                <th>주문정보</th>
                                <th>상태</th>
                                <th>확인/신청</th>
                            </tr>
                            <tr th:each="order , index :${pageResponseDTO.dtoList}">
                                <td class="date">[[${#dates.format(order.orderDate, 'yyyy-MM-dd')}]]</td>
                                <td>
                                    <a th:href="@{/product/view(prodno=${products[index.index].prodNo})}" class="thumb"><img style="width: 100px; height: 100px" th:src="@{/uploads/__${products[index.index].image1}__}" alt=""></a>
                                    <ul>
                                        <li class="prodName"><a th:href="@{#}">[[${products[index.index].prodName}]] 외 [ [[${orderItems[index.index].size() - 1}]] ]개</a></li>
                                         주문번호 : <span class="ordNo">[[${order.orderNo}]]</span></li>
                                        <li class="prodPrice">[[${order.orderTotalPrice}]]</li>
                                    </ul>
                                </td>
                                <td class="status">[[${order.orderState}]]</td>
                                <td class="confirm">
                                    <a th:href="@{#}" class="receive">수취확인</a>
                                    <a th:href="@{#}" class="review">상품평</a>
                                    <a th:href="@{#}" class="refund">반품신청</a>
                                    <a th:href="@{#}" class="exchange">교환신청</a>
                                </td>
                            </tr>
                        </table>

                        <th:block th:if="${pageResponseDTO.dtoList.size()==0}">
                            <h3 style="text-align: center">내역이 없습니다.</h3>
                        </th:block>
                        <th:block th:if="${pageResponseDTO.dtoList.size()>0}">
                            <th:block th:if="${pageResponseDTO.dateBegin != null && pageResponseDTO.dateBegin != ''}">
                            <p class="page">

                                <a  th:if="${pageResponseDTO.prev}" th:href="@{/my/order(pg=${pageResponseDTO.start - 1}, currentMonth=${pageResponseDTO.currentMonth}, oneWeek=${pageResponseDTO.oneWeek}, fifteen=${pageResponseDTO.fifteen}, dateBegin=${pageResponseDTO.dateBegin}, dateEnd=${pageResponseDTO.dateEnd})}" class="prev">이전</a>
                                <th:block th:each="num:${#numbers.sequence(pageResponseDTO.start, pageResponseDTO.end)}">
                                    <th:block th:if="${num == pageResponseDTO.pg}">
                                        <a th:href="@{/my/order( pg=${num } , currentMonth=${pageResponseDTO.currentMonth}, oneWeek=${pageResponseDTO.oneWeek}, fifteen=${pageResponseDTO.fifteen}, dateBegin=${pageResponseDTO.dateBegin}, dateEnd=${pageResponseDTO.dateEnd})}" class="on">[[${num}]]</a>
                                    </th:block>

                                    <th:block th:if="${num != pageResponseDTO.pg}">
                                        <a th:href="@{/my/order( pg=${num } , currentMonth=${pageResponseDTO.currentMonth}, oneWeek=${pageResponseDTO.oneWeek}, fifteen=${pageResponseDTO.fifteen}, dateBegin=${pageResponseDTO.dateBegin}, dateEnd=${pageResponseDTO.dateEnd})}" >[[${num}]]</a>
                                    </th:block>
                                </th:block>
                                <a  th:if="${pageResponseDTO.next}" th:href="@{/my/order( pg=${pageResponseDTO.end+1}, currentMonth=${pageResponseDTO.currentMonth}, oneWeek=${pageResponseDTO.oneWeek}, fifteen=${pageResponseDTO.fifteen}, dateBegin=${pageResponseDTO.dateBegin}, dateEnd=${pageResponseDTO.dateEnd})}" class="next">다음</a>
                            </p>
                        </th:block>
                            <th:block th:if="${pageResponseDTO.dateBegin == null || pageResponseDTO.dateBegin == ''}">
                                <p class="page">

                                    <a  th:if="${pageResponseDTO.prev}" th:href="@{/my/order(pg=${pageResponseDTO.start - 1}, currentMonth=${pageResponseDTO.currentMonth}, oneWeek=${pageResponseDTO.oneWeek})}" class="prev">이전</a>
                                    <th:block th:each="num:${#numbers.sequence(pageResponseDTO.start, pageResponseDTO.end)}">
                                        <th:block th:if="${num == pageResponseDTO.pg}">
                                            <a th:href="@{/my/order( pg=${num } , currentMonth=${pageResponseDTO.currentMonth}, oneWeek=${pageResponseDTO.oneWeek}, fifteen=${pageResponseDTO.fifteen})}" class="on">[[${num}]]</a>
                                        </th:block>

                                        <th:block th:if="${num != pageResponseDTO.pg}">
                                            <a th:href="@{/my/order( pg=${num } , currentMonth=${pageResponseDTO.currentMonth}, oneWeek=${pageResponseDTO.oneWeek}, fifteen=${pageResponseDTO.fifteen})}" >[[${num}]]</a>
                                        </th:block>
                                    </th:block>
                                    <a  th:if="${pageResponseDTO.next}" th:href="@{/my/order( pg=${pageResponseDTO.end+1}, currentMonth=${pageResponseDTO.currentMonth}, oneWeek=${pageResponseDTO.oneWeek}, fifteen=${pageResponseDTO.fifteen})}" class="next">다음</a>
                                </p>
                            </th:block>


                        </th:block>

                    </article>                  

                    

                </section>

            </div>
        </div>        

</html>